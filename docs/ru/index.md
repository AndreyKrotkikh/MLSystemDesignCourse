---
layout: plain
title: Курс по ML System Design
lang: ru
---

{% include lang_switcher.html %}

# Курс по ML System Design

## Авторы

{% assign authors = site.data.authors %}
{% if authors and authors.size > 0 %}
<ul>
  {% for person in authors %}
  <li>
    <strong>{{ person.name }}</strong>
    {% if person.role %} — {{ person.role }}{% endif %}
    {% if person.links and person.links.github %}
      · <a href="{{ person.links.github }}">GitHub</a>
    {% endif %}
  </li>
  {% endfor %}
  </ul>
{% else %}
<p>Список авторов пока пуст.</p>
{% endif %}

## Документы

- [Шаблон дизайн-документа]({{ '/ru/template' | relative_url }})
- [Чеклист дизайн-документа]({{ '/ru/checklist' | relative_url }})

## Дизайн‑документ проекта

### Резюме
- **Название проекта**: Динамическое ценообразование в Телекоме
- **Постановка задачи**: Построить user‑tariff based систему динамического ценообразования и персональных офферов для тарифов/опций на основе признаков пользователя, региона и конкурентов (временные ряды), с доставкой через App/Push/SMS/оффлайн/Voice (звонок по телефону) и триггерную платформу; динамика на опциях, репрайс/миграции для архивных тарифов с целью поддержания долгосрочных планов по доходам, доле рынка, KPI и удержания пользователей. Текущее решение не обладает должной степенью автоматизации, что приводит к необходимости ручной обработке данных и ручному ценообразованию, что приводит к ежедневной просадке прибыли компании и высокому риску человеческого фактора в виде потенциально необоснованных и неправильных решений и неверной трактовке обратной связи от пользователей.
- **Бизнес‑эффект**: Рост ARPU/LTV, снижение оттока, контроль GMV при фиксированной марже, удержание доли рынка; KPI: ARPU, churn, конверсия офферов, маржа, доля рынка, QoS/нагрузка сети.
- **Таймлайн**: ???

### I. Определение проблемы
- Истоки:
  - Суть: линейка базовых тарифов и множество архивных (≈5–10k); частые изменения абонплаты недопустимы; тренд к персонализации; различия по регионам и каналам.
  - Модель: user‑tariff based; признаки: пользовательские, региональные, конкурентные (временные ряды); каналы доставки цены: приложение/push, SMS, оффлайн.
  - Стейкхолдеры: коммерция/pricing, маркетинг, продукт‑менеджеры тарифов/опций, региональные продажи, финансы, юристы/регуляторика, CRM/BI/DS, поддержка, абоненты.
  - Ограничения: лимит повышения для архивных (регулятор ≤10%), цены/ассортимент зависят от региона и канала, определение реального пользователя SIM, нагрузка сети.
  - Происхождение тарифов: базовые тарифы создаёт маркетинг; под задачи ЦО согласуются персональные/сегментные тарифы; для миграций с архивных тарифов также запускаются новые планы. Персональные и персонализированные тарифы - разное, персональные/ползунковые (далее везде будет ползунковые) тарифы, пользователь самостоятельно определяет нужные ему параметры и цена автоматически пересчитывается, персонализированный - это компания самостоятельно предлагает тариф, либо выбор из базовых тарифов, в них допустима динамика.
  - Целеполагание: долгосрочный план доходов до 2028 года; квартальное планирование с заказчиками; между циклами поддерживаем текущие KPI.
  - Текущий процесс: 1–2 раза в год репрайс архивов или миграции; динамика разрешена на опциях; для разовых интернет‑пакетов используется uplift‑моделирование + бандиты; промо часто по правилам (триггерная платформа).
  - Триггеры: существует триггерная платформа (event → offer); напр., при 90% исчерпании пакета сразу отправляется SMS с опцией со скидкой.
- Важность и причины:
  - Цели: рост ARPU/LTV, снижение оттока, удержание доли рынка, улучшение юнит‑экономики, балансировка нагрузки сети.
  - Таргеты: max ARPU, churn prevention, контроль GMV при фиксированной марже.
  - Польза: выше конверсия персональных предложений, меньше массовых скидок, таргетированные региональные акции, лучшее покрытие сегментов пользователей.
  - Стоимость текущей проблемы: потеря маржи от массовых скидок, недоизвлечение willingness‑to‑pay, churn к конкурентам, неэффективные промо.
- Предыдущие попытки:
  - Базовая тарифная система с большим архивом; периодический репрайс; миграции на новые тарифы; частичная персонализация (>10% базы).
  - На опциях: динамическое ценообразование для разовых интернет‑пакетов через uplift‑моделирование и бандитов.
  - Что сработало: персонализация тарифа в приложении > массовые SMS; миграции увеличивают ARPU; бандиты дают uplift.
  - Что не сработало: частые изменения абонплаты вызывают негатив; массовые промо бьют по марже.
  - Улучшения: расширить динамику на больше опций, автоматизировать региональные кампании, увязать решения с нагрузкой сети и активностью конкурентов end‑to‑end.
- Прочие вопросы и риски:
  - Инфраструктура: витрины использования/баланса/каналов/регионов, каталог тарифов/опций/ограничений, фичестор, near‑real‑time decisioning, интеграции с CRM/приложением/SMS/IVR, A/B‑платформа, триггерная платформа событий, мониторинг.
  - Режимы отказа: неверные цены/правила → санкции/PR‑риски; перегруз сети; коллизии каналов; дрейф моделей; ошибки в идентификации владельца SIM; утечки данных.
  - Стоимость ошибок: штрафы и регуляторные риски, рост оттока, потеря маржи, рост нагрузки на поддержку.
  - Контроли: guardrails по ценам (для архивных ≤10%), eligibility/правила справедливости, регион/канал‑скоупинг, rate‑limits, канареечные релизы, офлайн/онлайн‑валидация, алерты по KPI, ручной override, объяснимость решений.
- Текущая реализация:
  - Персональные тарифы (оффлайн/целевые каналы) формируются в заданных бизнесом границах: min/max/step по `GB`, `минутам`, `SMS`. Стоимость считается по фиксированной региональной формуле вида `k_min * min + k_gb * gb^2 + k_sms * sms + k_base`. Коэффициенты фиксированы и не изменяются командой ценообразования; управляемая переменная — скидка поверх рассчитанной цены (типично 5–70%).
  - По истории строится модель вероятности взятия персонального тарифа; далее делается сетка параметров `(gb, min, sms, скидка)`, выполняется скоринг и выбор оптимума по целевой функции (например, max ARPU/GMV при маржинальных/регуляторных ограничениях). Эластичность по скидке получается эмпирически: для фиксированного `(gb, min, sms)` варьируем скидку и наблюдаем изменение score/конверсии.
  - Базовая линейка тарифов оперативно не репрайсится; динамика допускается для персональных тарифов и опций. По опциям можем управлять: ценой, объёмом ("чиселкой" гигабайтов) и персональными скидками.
  - Рекомендации опций (триггеры): при исчерпании трафика предлагаем варианты — (1) разовый пакет, (2) подписка на доп‑интернет, если потребление стабильно выше, (3) апгрейд пакета, если у клиента также кончаются минуты/SMS или они нерелевантны. Учитываем краткосрочные сценарии 1–3 месяца (командировки/сезонность), когда клиенту выгоднее временные опции, чем постоянный переход на более дорогой тариф.
  - GMV‑декомпозиция: `GMV_Total = GMV_Tariffs + GMV_Options`. Для тарифов тюним сегментные эластичности через сетку персональных предложений; для опций — динамическое ценообразование и управление ассортиментом рекомендаций.
  - Каннибализация: мониторим взаимное влияние тарифов и опций, а также продуктов (напр., классическое ТВ vs интернет‑ТВ; модемы/«свистки» vs раздача с телефона). Вводим guardrails и мониторинги, чтобы ловить неожиданные просадки.
  - Способы управления: (1) скидка на персональный тариф, (2) параметры и цены опций (включая объём), (3) логика рекомендаций/триггеры и каналы доставки (App/Push/SMS/оффлайн/Voice).

![Схема 1]({{ '/img/MLDesign_img_1.jpeg' | relative_url }})

![Схема 2]({{ '/img/MLDesign_img_2.jpeg' | relative_url }})

## II. Метрики и функции потерь

### i. Метрики
- Бизнес: ARPU (Average Revenue per User), GMV (Gross Merchandise Value), маржа, LTV (Lifetime Value), churn, конверсия офферов, доля рынка, выручка от опций, NPS (Net Promoter Score)/CSAT (Customer Satisfaction Score).
- Модель: AUC/PR‑AUC/LogLoss (take‑rate); Brier Score, ECE для калибровки, uplift@K/uplift‑AUC/CATE  (для промо/опций), mean regret (бандиты).
- Связь с бизнес целями: оптимизируем ARPU/GMV при ограничениях на маржу и конверсию; снижаем churn за счёт апгрейдов/персональных тарифов; контролируем каннибализацию между различными каналами продаж.
- Trade-offs: ARPU vs churn; GMV vs маржа; краткосрочный GMV vs LTV; персонализация vs справедливость/регуляторика.

### ii. Функции потерь
- Take‑rate: Focal; 
- Uplift/промо: S/T/DR‑learner; цель — uplift@K/инкрементальная выручка.
- Бандиты: regret .

## III. Датасет

### i. Источники данных
- Внутренние: биллинг/CDR/балансы/остатки, история тарифов/опций/каталог/ограничения, CRM/триггеры/кампании, логи App/Push/SMS/оффлайн, отклики/продажи, A/B‑платформа, QoS сети (нагрузка/покрытие), регион/канал.
- Внешние: цены конкурентов/агрегаторы, макро (CPI/доходы), календарь/праздники/сезонность/погода, демография региона.
- Проблемы качества: задержки, дубликаты/пропуски, несогласованные справочники по регионам/каналам, тайм‑зоны, SIM↔пользователь, атрибуция конверсий/инкремента.
- Свежесь: триггеры — 5–15 мин; онлайн‑фичи — минутно/часово; агрегации — ежедневно; конкуренты — ежедневно/недельно.

### ii. Разметка данных
- Лейблы: take‑rate (0/1) на оффер; выручка/маржа в окне T; churn/миграция; для uplift — treatment/control.
- Процесс: оффлайн из логов; удаление дублей, фильтр ботов/фрода.
- Качество: синхронизация временных меток, sanity‑чек на срезах.
- Затраты: расходы — вычисления/хранилище.

### iii. Доступные метаданные
- Регион, канал, устройство, eligibility/правила, регуляторные лимиты, история цен/акций, флаги экспериментов, календарь/сезонность.

### iv. Проблемы качества данных
- Типовые: пропуски/дубликаты, дрейф, смещения из‑за промо, редкие классы.
- Решения: окна/lag‑фичи, нормализация справочников, стратификация/регуляризация, отсечение выбросов, установка последовательности событий.

### v. ETL‑конвейер
- Ingestion: CDC/Kafka из биллинга/логов, batch из витрин.
- Преобразования: очистка, нормализация справочников, агрегации (7/30/90д), материализация в офлайн/онлайн фичестор.
- Обновления: онлайн‑признаки — минутно/часово; оффлайн — ежедневно; бэкофиллы по расписанию.
- Мониторинг: свежесть, доли классов, дрейф/качество фич.

## IV. Схема валидации

### i. Требования
- Каковы требования к валидации?
- Как предотвратим утечки данных?
- Какие временные ограничения существуют?

### ii. Инференс
- Как модель делает предсказания?
- Каков горизонт предсказания?
- Какие ограничения учитывать?

### iii. Внутренние и внешние циклы
- Как будем валидировать модель?
- Какую стратегию кросс‑валидации используем?
- Как обрабатываем временные ряды?

### iv. Частота обновления
- Как часто обновляем модель?
- Что является триггером обновления?
- Как обрабатываем дрейф данных?

## V. Baseline

### i. Константный baseline
- Какие простые бейзлайны используем?
- Как будем с ними сравниваться?
- Каков минимально приемлемый результат?

### ii. Базовые модели
- Какие архитектуры попробуем?
- Каковы компромиссы?
- Как будем сравнивать?

### iii. Базовые признаки
- С какими признаками начнём?
- Как измерим важность признаков?
- Какой feature‑инжиниринг нужен?
